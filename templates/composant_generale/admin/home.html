{% extends 'composant_generale/admin/base.html' %}

{% block title %}
  Accueil - Administration YZ-CMD
{% endblock %}

{% block page_title %}
  Tableau de Bord
{% endblock %}
{% block page_subtitle %}
  Vue d'overview de l'activit√©
{% endblock %}

{% block content %}
  <!-- Syst√®me de Filtres KPIs -->
  {% include 'kpis/components/filters.html' %}

  <!-- Navigation par Onglets et Contenu -->
  {% include 'kpis/components/tabs_navigation.html' %}

  <!-- Scripts pour Chart.js et autres biblioth√®ques -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- Scripts KPIs Yoozak -->
  {% load static %}
  <script src="{% static 'js/kpis/dashboard.js' %}"></script>

  <!-- Styles CSS personnalis√©s pour les animations -->
  <style>
    /* Animations d'entr√©e */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-slideInUp {
      animation: slideInUp 0.6s ease-out forwards;
    }
    
    /* D√©lais d'animation en cascade */
    .kpi-card:nth-child(1) {
      animation-delay: 0.1s;
    }
    .kpi-card:nth-child(2) {
      animation-delay: 0.2s;
    }
    .kpi-card:nth-child(3) {
      animation-delay: 0.3s;
    }
    .kpi-card:nth-child(4) {
      animation-delay: 0.4s;
    }
    
    /* Effets hover personnalis√©s */
    .group:hover .group-hover\:scale-110 {
      transform: scale(1.1);
    }
    
    /* Styles responsive am√©lior√©s */
    @media (max-width: 768px) {
      .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
    
      .kpi-tab-button {
        font-size: 0.875rem;
        padding: 0.75rem 0.5rem;
      }
    
      .kpi-tab-button span:last-child {
        display: none;
      }
    }
    
    /* Th√®me couleurs Yoozak */
    :root {
      --yoozak-blue: #3b82f6;
      --yoozak-green: #10b981;
      --yoozak-orange: #f59e0b;
      --yoozak-purple: #8b5cf6;
      --yoozak-brown: #92400e;
    }
    
    /* Loading states pour les cartes KPIs */
    .kpi-loading {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }
  </style>

  <!-- Script d'initialisation globale -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      console.log('üè† Dashboard KPIs Yoozak initialis√©')
    
      // √âmettre un √©v√©nement personnalis√© pour signaler que le dashboard est pr√™t
      const event = new CustomEvent('dashboardReady', {
        detail: {
          version: '1.0',
          features: ['filters', 'tabs', 'kpi-cards', 'charts'],
          timestamp: new Date().toISOString()
        }
      })
      document.dispatchEvent(event)
    
      // Log pour le d√©veloppement
      if (typeof console !== 'undefined') {
        console.log('%cüöÄ Nouveau Dashboard KPIs Yoozak', 'color: #3b82f6; font-size: 16px; font-weight: bold;')
        console.log('üìä 5 onglets sp√©cialis√©s chaussures & sandales')
        console.log('üéØ Filtres g√©ographiques Maroc d√©taill√©s')
        console.log('üì± Design responsive mobile-first')
      }
    })
    
    // Fonction globale pour mettre √† jour tous les KPIs
    window.refreshAllKPIs = function () {
      // Cette fonction sera √©tendue pour faire des appels AJAX
      console.log('üîÑ Actualisation de tous les KPIs...')
    
      // D√©clencher l'√©v√©nement de mise √† jour
      const event = new CustomEvent('kpiUpdated', {
        detail: { timestamp: new Date() }
      })
      document.dispatchEvent(event)
    }
    
    // Gestion globale des erreurs de chargement des graphiques
    window.addEventListener('error', function (e) {
      if (e.target.tagName === 'CANVAS') {
        console.warn('Erreur de chargement graphique:', e.target.id)
        // Afficher un placeholder en cas d'erreur
        const parent = e.target.parentElement
        if (parent) {
          parent.innerHTML = '<div class="h-full flex items-center justify-center text-gray-500"><i class="fas fa-chart-line mr-2"></i>Graphique temporairement indisponible</div>'
        }
      }
    })
  </script>
{% endblock %}
