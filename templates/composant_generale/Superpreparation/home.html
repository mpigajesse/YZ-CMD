{% extends 'composant_generale/Superpreparation/base.html' %}

{% block title %}{{ page_title }} - YZ-CMD{% endblock %}

{% block page_title %}{{ page_title }}{% endblock %}
{% block page_subtitle %}{{ page_subtitle }}{% endblock %}

{% block content %}
<!-- Alertes de supervision en haut -->
{% if stats.alertes %}
<div class="mb-6">
    {% for alerte in stats.alertes %}
    <div class="{% if alerte.type == 'urgent' %}bg-red-100 border-red-500 text-red-800{% elif alerte.type == 'warning' %}bg-yellow-100 border-yellow-500 text-yellow-800{% else %}bg-blue-100 border-blue-500 text-blue-800{% endif %} border-l-4 p-4 mb-3 rounded-r-lg shadow-sm flex items-center justify-between">
        <div class="flex items-center">
            <i class="{{ alerte.icon }} text-xl mr-3 {% if alerte.type == 'urgent' %}text-red-600{% elif alerte.type == 'warning' %}text-yellow-600{% else %}text-blue-600{% endif %}"></i>
            <span class="font-medium">{{ alerte.message }}</span>
        </div>
        <a href="{% url alerte.url %}" class="{% if alerte.type == 'urgent' %}bg-red-600 hover:bg-red-700{% elif alerte.type == 'warning' %}bg-yellow-600 hover:bg-yellow-700{% else %}bg-blue-600 hover:bg-blue-700{% endif %} text-white px-3 py-1 rounded text-sm font-medium transition-colors">
            Voir
        </a>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Métriques principales de supervision -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">


    <!-- Commandes en préparation -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border-l-4 border-orange-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600 mb-1">En Préparation</p>
                <p class="text-3xl font-bold text-orange-600">{{ stats.commandes_en_cours }}</p>
                <a href="{% url 'Superpreparation:commandes_en_preparation' %}" class="text-xs text-orange-500 hover:text-orange-700 font-medium">Voir toutes →</a>
            </div>
            <div class="p-3 rounded-full bg-orange-100 group-hover:bg-orange-500 transition-all duration-300">
                <i class="fas fa-cog fa-spin text-orange-600 group-hover:text-white text-xl"></i>
            </div>
        </div>
    </div>

    <!-- Commandes livrées partiellement -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border-l-4 border-yellow-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Livrées Part.</p>
                <p class="text-3xl font-bold text-yellow-600">{{ stats.commandes_livrees_partiellement }}</p>
                <a href="{% url 'Superpreparation:commandes_livrees_partiellement' %}" class="text-xs text-yellow-600 hover:text-yellow-700 font-medium">Voir toutes →</a>
            </div>
            <div class="p-3 rounded-full bg-yellow-100 group-hover:bg-yellow-500 transition-all duration-300">
                <i class="fas fa-truck text-yellow-600 group-hover:text-white text-xl"></i>
            </div>
        </div>
    </div>

    <!-- Commandes retournées -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border-l-4 border-red-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Retournées</p>
                <p class="text-3xl font-bold text-red-600">{{ stats.commandes_retournees }}</p>
                <a href="{% url 'Superpreparation:commandes_retournees' %}" class="text-xs text-red-500 hover:text-red-700 font-medium">Voir toutes →</a>
            </div>
            <div class="p-3 rounded-full bg-red-100 group-hover:bg-red-500 transition-all duration-300">
                <i class="fas fa-undo text-red-600 group-hover:text-white text-xl"></i>
            </div>
        </div>
    </div>

    <!-- Total actif -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Total Actives</p>
                <p class="text-3xl font-bold text-green-600">{{ stats.total_commandes_actives }}</p>
                <p class="text-xs text-green-500 font-medium">Supervision</p>
            </div>
            <div class="p-3 rounded-full bg-green-100 group-hover:bg-green-500 transition-all duration-300">
                <i class="fas fa-eye text-green-600 group-hover:text-white text-xl"></i>
            </div>
        </div>
    </div>
</div>

<!-- KPIs et Performance -->
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
    <div class="group bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl shadow-lg p-6 text-white transition-all duration-300 hover:shadow-2xl hover:scale-105 transform">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold group-hover:text-purple-100 transition-colors duration-300">Performance Globale</h3>
            <i class="fas fa-chart-line text-2xl opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300"></i>
        </div>
        <p class="text-3xl font-bold group-hover:scale-110 transition-transform duration-300">{{ stats.performance_globale_today }}</p>
        <p class="text-sm opacity-90 group-hover:opacity-100 transition-opacity duration-300">Préparations terminées aujourd'hui</p>
    </div>

    <div class="group bg-gradient-to-br from-green-500 to-green-700 rounded-xl shadow-lg p-6 text-white transition-all duration-300 hover:shadow-2xl hover:scale-105 transform">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold group-hover:text-green-100 transition-colors duration-300">Valeur Traitée</h3>
            <i class="fas fa-coins text-2xl opacity-80 group-hover:opacity-100 group-hover:scale-110 group-hover:rotate-12 transition-all duration-300"></i>
        </div>
        <p class="text-3xl font-bold group-hover:scale-110 transition-transform duration-300">{{ stats.valeur_totale_today|floatformat:0 }}</p>
        <p class="text-sm opacity-90 group-hover:opacity-100 transition-opacity duration-300">DH traités aujourd'hui</p>
    </div>

    <div class="group bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl shadow-lg p-6 text-white transition-all duration-300 hover:shadow-2xl hover:scale-105 transform">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold group-hover:text-blue-100 transition-colors duration-300">Taux de Réussite</h3>
            <i class="fas fa-bullseye text-2xl opacity-80 group-hover:opacity-100 group-hover:scale-110 group-hover:pulse transition-all duration-300"></i>
        </div>
        <p class="text-3xl font-bold group-hover:scale-110 transition-transform duration-300">{{ stats.taux_reussite }}%</p>
        <p class="text-sm opacity-90 group-hover:opacity-100 transition-opacity duration-300">Efficacité aujourd'hui</p>
    </div>

    <div class="group bg-gradient-to-br from-teal-500 to-teal-700 rounded-xl shadow-lg p-6 text-white transition-all duration-300 hover:shadow-2xl hover:scale-105 transform">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold group-hover:text-teal-100 transition-colors duration-300">Confirmées</h3>
            <i class="fas fa-check-circle text-2xl opacity-80 group-hover:opacity-100 group-hover:scale-110 group-hover:animate-bounce transition-all duration-300"></i>
        </div>
        <p class="text-3xl font-bold group-hover:scale-110 transition-transform duration-300">{{ stats.commandes_confirmees_today }}</p>
        <p class="text-sm opacity-90 group-hover:opacity-100 transition-opacity duration-300">Reçues aujourd'hui</p>
    </div>
</div>

<!-- Graphiques et données détaillées -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Graphique de performance -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 transform border border-gray-100 hover:border-purple-200">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-800 group-hover:text-purple-600 transition-colors duration-300">Performance de la Journée</h3>
            <div class="text-sm text-gray-500 group-hover:text-purple-500 transition-colors duration-300">{{ "now"|date:"d/m/Y" }}</div>
        </div>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-green-50 transition-all duration-300 transform hover:scale-102 hover:shadow-md">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-green-500 rounded-full mr-3 hover:animate-pulse"></div>
                    <span class="font-medium hover:text-green-700 transition-colors">Terminées</span>
                </div>
                <span class="font-bold text-green-600 hover:scale-110 transition-transform duration-200">{{ stats.performance_globale_today }}</span>
            </div>
            
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-orange-50 transition-all duration-300 transform hover:scale-102 hover:shadow-md">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-orange-500 rounded-full mr-3 hover:animate-spin"></div>
                    <span class="font-medium hover:text-orange-700 transition-colors">En cours</span>
                </div>
                <span class="font-bold text-orange-600 hover:scale-110 transition-transform duration-200">{{ stats.commandes_en_cours }}</span>
            </div>
            

        </div>
        
        <!-- Barre de progression globale -->
        <div class="mt-6">
            <div class="flex justify-between text-sm text-gray-600 mb-2">
                <span>Progression journalière</span>
                <span>{{ stats.taux_reussite }}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-1000" style="width: {{ stats.taux_reussite }}%"></div>
            </div>
        </div>
    </div>

    <!-- Articles populaires -->
    <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 transform border border-gray-100 hover:border-teal-200">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-800 group-hover:text-teal-600 transition-colors duration-300">Articles les Plus Traités</h3>
            <div class="text-sm text-gray-500 group-hover:text-teal-500 transition-colors duration-300">Cette semaine</div>
        </div>
        
        <div class="space-y-3">
            {% for article in stats.articles_populaires %}
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-teal-50 transition-all duration-300 transform hover:scale-102 hover:shadow-md border border-transparent hover:border-teal-200">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center mr-3 transition-all duration-300 hover:bg-teal-500 hover:scale-110">
                        <i class="fas fa-box text-teal-600 transition-colors duration-300 hover:text-white"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800 hover:text-teal-700 transition-colors duration-300">{{ article.article__nom|truncatechars:25 }}</p>
                        <p class="text-xs text-gray-500 hover:text-teal-500 transition-colors duration-300">{{ article.article__reference }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="font-bold text-teal-600 hover:scale-110 transition-transform duration-200">{{ article.total_quantite }}</p>
                    <p class="text-xs text-gray-500 hover:text-teal-500 transition-colors duration-300">{{ article.total_commandes }} cmd</p>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-8">
                <i class="fas fa-chart-bar text-4xl text-gray-300 mb-3"></i>
                <p class="text-gray-500">Aucune donnée cette semaine</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Raccourcis vers les pages de suivi -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-8">
    <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <i class="fas fa-tachometer-alt text-purple-500 mr-3"></i>
            Actions Rapides de Supervision
        </h3>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

        
        <a href="{% url 'Superpreparation:commandes_en_preparation' %}" class="group p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-all duration-300 transform hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <i class="fas fa-cog text-orange-600 text-2xl group-hover:rotate-180 transition-transform duration-500"></i>
                <span class="bg-orange-600 text-white text-xs px-2 py-1 rounded-full">{{ stats.commandes_en_cours }}</span>
            </div>
            <h4 class="font-semibold text-orange-800">Suivi Préparation</h4>
            <p class="text-sm text-orange-600">En cours de traitement</p>
        </a>
        
        <a href="{% url 'Superpreparation:commandes_livrees_partiellement' %}" class="group p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-all duration-300 transform hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <i class="fas fa-truck text-yellow-600 text-2xl group-hover:translate-x-2 transition-transform"></i>
                <span class="bg-yellow-600 text-white text-xs px-2 py-1 rounded-full">{{ stats.commandes_livrees_partiellement }}</span>
            </div>
            <h4 class="font-semibold text-yellow-800">Livraisons Partielles</h4>
            <p class="text-sm text-yellow-600">Nécessitent attention</p>
        </a>
        
        <a href="{% url 'Superpreparation:commandes_retournees' %}" class="group p-4 bg-red-50 hover:bg-red-100 rounded-lg transition-all duration-300 transform hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <i class="fas fa-undo text-red-600 text-2xl group-hover:rotate-180 transition-transform duration-500"></i>
                <span class="bg-red-600 text-white text-xs px-2 py-1 rounded-full">{{ stats.commandes_retournees }}</span>
            </div>
            <h4 class="font-semibold text-red-800">Commandes Retournées</h4>
            <p class="text-sm text-red-600">Traitement urgent</p>
        </a>
    </div>
</div>

<!-- Activité récente -->
<div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 transform border border-gray-100 hover:border-purple-200">
    <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-800 flex items-center group-hover:text-purple-600 transition-colors duration-300">
            <i class="fas fa-clock text-purple-500 mr-3 group-hover:animate-spin transition-all duration-300"></i>
            Activité Récente
        </h3>
        <div class="text-sm text-gray-500 group-hover:text-purple-500 transition-colors duration-300">
            {{ stats.activite_recente|length }} action{{ stats.activite_recente|length|pluralize }} récente{{ stats.activite_recente|length|pluralize }}
        </div>
    </div>
    
    <div class="space-y-3">
        {% for activite in stats.activite_recente %}
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-green-50 transition-all duration-300 transform hover:scale-102 hover:shadow-md border border-transparent hover:border-green-200">
            <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded-full mr-4 animate-pulse hover:animate-ping"></div>
                <div>
                    <p class="font-medium text-gray-800 hover:text-green-700 transition-colors duration-300">Commande #{{ activite.commande.id_yz }}</p>
                    <p class="text-sm text-gray-600 hover:text-green-600 transition-colors duration-300">{{ activite.commande.client.nom }} {{ activite.commande.client.prenom }}</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-500 hover:text-green-500 transition-colors duration-300">{{ activite.date_fin|date:"H:i" }}</p>
                <p class="text-xs text-green-600 font-medium hover:scale-110 transition-transform duration-200">Terminée</p>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-8">
            <i class="fas fa-clock text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">Aucune activité récente</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Auto-refresh et animations -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation pour les compteurs
    function animateCounters() {
        const counters = document.querySelectorAll('.text-3xl.font-bold');
        counters.forEach(counter => {
            const target = parseInt(counter.textContent);
            let count = 0;
            const increment = target / 20;
            
            const timer = setInterval(() => {
                count += increment;
                if (count >= target) {
                    counter.textContent = target;
                    clearInterval(timer);
                } else {
                    counter.textContent = Math.floor(count);
                }
            }, 50);
        });
    }
    
    // Auto-refresh toutes les 30 secondes
    setInterval(() => {
        location.reload();
    }, 30000);
    
    // Animation au chargement
    animateCounters();
    
    // Interaction hover pour les cartes
    const cards = document.querySelectorAll('.group');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Status indicator
    const statusDiv = document.createElement('div');
    statusDiv.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg';
    statusDiv.innerHTML = '<i class="fas fa-wifi mr-2"></i>Supervision Active';
    document.body.appendChild(statusDiv);
});
</script>

<!-- Styles personnalisés -->
<style>
@keyframes pulse-green {
    0%, 100% { background-color: #10b981; }
    50% { background-color: #059669; }
}

.animate-pulse-green {
    animation: pulse-green 2s infinite;
}

/* Effets de hover améliorés */
.group:hover .fa-cog {
    animation: spin 2s linear infinite;
}

.group:hover .fa-truck {
    animation: truck-move 1s ease-in-out infinite alternate;
}

.group:hover .fa-coins {
    animation: coin-flip 0.6s ease-in-out;
}

.group:hover .fa-check-circle {
    animation: bounce 0.5s ease-in-out;
}

.hover\:scale-102:hover {
    transform: scale(1.02);
}

@keyframes truck-move {
    from { transform: translateX(0); }
    to { transform: translateX(5px); }
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes coin-flip {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg); }
    100% { transform: rotateY(360deg); }
}

@keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Gradient borders */
.border-gradient {
    background: linear-gradient(white, white) padding-box,
                linear-gradient(45deg, #3b82f6, #8b5cf6, #06d6a0) border-box;
    border: 2px solid transparent;
}

/* Effets de pulsation personnalisés */
.animate-pulse-custom {
    animation: pulse-custom 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse-custom {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.7;
        transform: scale(1.05);
    }
}

/* Animation de glissement fluide */
.slide-in {
    animation: slide-in 0.5s ease-out;
}

@keyframes slide-in {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}