{% extends 'composant_generale/admin/base.html' %}
{% load static %}

{% block title %}Gestion des Paniers - YZ-CMD{% endblock %}

{% block extra_css %}
<style>
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-slideInUp {
        animation: slideInUp 0.6s ease-out forwards;
        opacity: 0;
    }

    .panier-card {
        transition: all 0.3s ease;
    }

    .panier-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content transition-all duration-300" id="mainContent">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 bg-white rounded-xl shadow-md p-6" style="border-left: 4px solid var(--admin-color);">
        <div>
            <h1 class="text-3xl font-bold mb-2" style="color: var(--admin-color);">Gestion des Paniers</h1>
            <p style="color: var(--admin-accent-color);">Vue d'ensemble de tous les paniers clients</p>
        </div>
        <div class="flex items-center gap-4 mt-4 md:mt-0">
            <a href="{% url 'commande:liste' %}" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm">
                <i class="fas fa-list mr-2"></i>Toutes les Commandes
            </a>
            <a href="{% url 'commande:non_affectees' %}" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm">
                <i class="fas fa-user-clock mr-2"></i>Non Affectées
            </a>
        </div>
    </div>



    <!-- Statistiques générales -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total paniers -->
        <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border border-gray-100 hover:border-blue-300 animate-slideInUp" style="animation-delay: 0.1s;">
            <div class="flex items-center">
                <div class="p-4 rounded-full bg-gradient-to-r from-blue-100 to-blue-200 text-blue-600 transition-all duration-300 group-hover:from-blue-500 group-hover:to-blue-600 group-hover:text-white group-hover:scale-110">
                    <i class="fas fa-shopping-basket text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Total Paniers</p>
                    <p class="text-3xl font-bold text-gray-900 transition-all duration-300 group-hover:text-blue-600">{{ total_paniers|default:0 }}</p>
                </div>
            </div>
        </div>

        <!-- Total articles -->
        <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border border-gray-100 hover:border-green-300 animate-slideInUp" style="animation-delay: 0.15s;">
            <div class="flex items-center">
                <div class="p-4 rounded-full bg-gradient-to-r from-green-100 to-green-200 text-green-600 transition-all duration-300 group-hover:from-green-500 group-hover:to-green-600 group-hover:text-white group-hover:scale-110">
                    <i class="fas fa-cubes text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Total Articles</p>
                    <p class="text-3xl font-bold text-gray-900 transition-all duration-300 group-hover:text-green-600">{{ total_articles|default:0 }}</p>
                </div>
            </div>
        </div>

        <!-- Valeur totale -->
        <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border border-gray-100 hover:border-purple-300 animate-slideInUp" style="animation-delay: 0.2s;">
            <div class="flex items-center">
                <div class="p-4 rounded-full bg-gradient-to-r from-purple-100 to-purple-200 text-purple-600 transition-all duration-300 group-hover:from-purple-500 group-hover:to-purple-600 group-hover:text-white group-hover:scale-110">
                    <i class="fas fa-coins text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Valeur Totale</p>
                    <p class="text-3xl font-bold text-gray-900 transition-all duration-300 group-hover:text-purple-600">{{ total_valeur|floatformat:2|default:0 }} DH</p>
                </div>
            </div>
        </div>

        <!-- Moyenne par panier -->
        <div class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-2xl hover:scale-105 border border-gray-100 hover:border-orange-300 animate-slideInUp" style="animation-delay: 0.25s;">
            <div class="flex items-center">
                <div class="p-4 rounded-full bg-gradient-to-r from-orange-100 to-orange-200 text-orange-600 transition-all duration-300 group-hover:from-orange-500 group-hover:to-orange-600 group-hover:text-white group-hover:scale-110">
                    <i class="fas fa-chart-line text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Moyenne/Panier</p>
                    <p class="text-3xl font-bold text-gray-900 transition-all duration-300 group-hover:text-orange-600">
                        {% if total_paniers > 0 %}
                            {% widthratio total_valeur 1 total_paniers %}
                        {% else %}
                            0.00
                        {% endif %} DH
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtres intelligents par état -->
    <div class="bg-white rounded-xl shadow-md border p-6 mb-8" style="border-color: var(--admin-light-accent);">
        <!-- Filtres rapides par état -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-4" style="color: var(--admin-color);">
                <i class="fas fa-filter mr-2"></i>Filtrage par État de Commande
            </h3>
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'commande:paniers' %}" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if not etat_filter %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    <i class="fas fa-list mr-2"></i>
                    Tous les paniers
                    <span class="ml-2 bg-white text-blue-800 px-2 py-1 rounded-full text-xs font-bold">{{ total_paniers }}</span>
                </a>
                
                <a href="?etat=Non affectée" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Non affectée' %}bg-orange-500 text-white{% else %}bg-orange-100 text-orange-700 hover:bg-orange-200{% endif %}">
                    <i class="fas fa-clock mr-2"></i>
                    Non affectées
                    <span class="ml-2 bg-white text-orange-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.non_affectees|default:0 }}</span>
                </a>
                
                <a href="?etat=Affectée" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Affectée' %}bg-blue-500 text-white{% else %}bg-blue-100 text-blue-700 hover:bg-blue-200{% endif %}">
                    <i class="fas fa-user-check mr-2"></i>
                    Affectées
                    <span class="ml-2 bg-white text-blue-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.affectees|default:0 }}</span>
                </a>
                
                <a href="?etat=Confirmée" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Confirmée' %}bg-green-500 text-white{% else %}bg-green-100 text-green-700 hover:bg-green-200{% endif %}">
                    <i class="fas fa-check-circle mr-2"></i>
                    Confirmées
                    <span class="ml-2 bg-white text-green-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.confirmees|default:0 }}</span>
                </a>
                
                <a href="?etat=Livrée" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Livrée' %}bg-emerald-500 text-white{% else %}bg-emerald-100 text-emerald-700 hover:bg-emerald-200{% endif %}">
                    <i class="fas fa-truck mr-2"></i>
                    Livrées
                    <span class="ml-2 bg-white text-emerald-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.livrees|default:0 }}</span>
                </a>
                
                <a href="?etat=Doublon" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Doublon' %}bg-red-500 text-white{% else %}bg-red-100 text-red-700 hover:bg-red-200{% endif %}">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Doublons
                    <span class="ml-2 bg-white text-red-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.doublons|default:0 }}</span>
                </a>
                
                <a href="?etat=Annulée" class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all shadow-sm {% if etat_filter == 'Annulée' %}bg-gray-500 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    <i class="fas fa-ban mr-2"></i>
                    Annulées
                    <span class="ml-2 bg-white text-gray-800 px-2 py-1 rounded-full text-xs font-bold">{{ stats_etats.annulees|default:0 }}</span>
                </a>
            </div>
        </div>

        <!-- Recherche et filtres détaillés -->
        <form method="get" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Recherche globale -->
                <div>
                    <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Recherche globale</label>
                    <div class="relative">
                        <input type="text" name="search" id="search" value="{{ search_query|default:'' }}" 
                               class="w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-offset-2 transition-all" 
                               style="border-color: var(--admin-accent-color); focus:ring-color: var(--admin-color);"
                               placeholder="Commande, client, article...">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>

                <!-- Filtre par client -->
                <div>
                    <label for="client" class="block text-sm font-medium text-gray-700 mb-2">Client spécifique</label>
                    <select name="client" id="client" class="w-full py-2 px-3 rounded-lg border focus:ring-2 focus:ring-offset-2 transition-all" style="border-color: var(--admin-accent-color);">
                        <option value="">Tous les clients</option>
                        {% for client in clients %}
                            <option value="{{ client.pk }}" {% if client_filter == client.pk|stringformat:"s" %}selected{% endif %}>
                                {{ client.nom }} {{ client.prenom }} ({{ client.numero_tel }})
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Filtre par article -->
                <div>
                    <label for="article" class="block text-sm font-medium text-gray-700 mb-2">Article spécifique</label>
                    <select name="article" id="article" class="w-full py-2 px-3 rounded-lg border focus:ring-2 focus:ring-offset-2 transition-all" style="border-color: var(--admin-accent-color);">
                        <option value="">Tous les articles</option>
                        {% for article in articles %}
                            <option value="{{ article.pk }}" {% if article_filter == article.pk|stringformat:"s" %}selected{% endif %}>
                                {{ article.nom }} ({{ article.reference }})
                            </option>
                        {% endfor %}
                    </select>
                </div>
                </div>

            <div class="flex justify-between items-center pt-4">
                <div class="flex gap-2">
                    <button type="submit" class="px-6 py-2 rounded-lg text-white font-medium transition-all shadow-md hover:shadow-lg transform hover:scale-105" 
                            style="background-color: var(--admin-color);">
                        <i class="fas fa-filter mr-2"></i>Filtrer
                    </button>
                    {% if search_query or client_filter or article_filter or etat_filter %}
                    <a href="{% url 'commande:paniers' %}" class="px-6 py-2 rounded-lg bg-gray-500 text-white font-medium transition-all shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Réinitialiser
                    </a>
                    {% endif %}
                </div>
                
                <div class="text-sm text-gray-600">
                    <i class="fas fa-info-circle mr-1"></i>
                    {{ page_obj.paginator.count }} panier(s) trouvé(s)
                </div>
            </div>
            </form>
        </div>

    <!-- Switch d'affichage -->
    {% if page_obj %}
    <div class="flex justify-end mb-4">
        <div class="flex bg-gray-100 rounded-lg p-1">
            <button id="viewTable" class="px-3 py-1 rounded-lg text-sm font-medium transition-all bg-white shadow-sm" style="color: var(--admin-color);">
                <i class="fas fa-table mr-1"></i>Tableau
            </button>
            <button id="viewCards" class="px-3 py-1 rounded-lg text-sm font-medium transition-all text-gray-600 hover:text-gray-800">
                <i class="fas fa-th-large mr-1"></i>Cards
            </button>
        </div>
    </div>
    {% endif %}

    <!-- Message si aucun résultat -->
    {% if not page_obj %}
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-8 rounded-lg">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-blue-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    {% if search_query or client_filter or article_filter or etat_filter %}
                        Aucun panier trouvé avec les filtres appliqués.
                    {% else %}
                        Aucun panier disponible dans le système.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Tableau des paniers -->
    {% if page_obj %}
    <div id="tableView" class="overflow-x-auto mb-8 bg-white rounded-xl shadow-lg">
        <table class="min-w-full divide-y divide-gray-200">
            <thead style="background-color: var(--admin-color);">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Commande</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Client</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Article</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Quantité</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Prix Unit.</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Sous-total</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">État</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Date</th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Actions</th>
                </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                {% for panier in page_obj %}
                <tr class="panier-card hover:bg-gray-50">
                    <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{ panier.commande.id_yz }}</div>
                                {% if panier.commande.num_cmd %}
                                <div class="text-sm text-gray-500">({{ panier.commande.num_cmd }})</div>
                                {% endif %}
                            </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <div class="h-10 w-10 rounded-full bg-gradient-to-r from-blue-100 to-blue-200 flex items-center justify-center">
                                    <i class="fas fa-user text-blue-600"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">{{ panier.commande.client.nom }} {{ panier.commande.client.prenom }}</div>
                                <div class="text-sm text-gray-500">{{ panier.commande.client.numero_tel }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            {% if panier.article.image %}
                            <div class="flex-shrink-0 h-10 w-10">
                                <img class="h-10 w-10 rounded-lg object-cover" src="{{ panier.article.image.url }}" alt="{{ panier.article.nom }}">
                            </div>
                            {% else %}
                            <div class="flex-shrink-0 h-10 w-10">
                                <div class="h-10 w-10 rounded-lg bg-gradient-to-r from-gray-100 to-gray-200 flex items-center justify-center">
                                    <i class="fas fa-box text-gray-600"></i>
                                </div>
                            </div>
                            {% endif %}
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">{{ panier.article.nom }}</div>
                                <div class="text-sm text-gray-500">{{ panier.article.reference }}</div>
                                {% if panier.article.couleur or panier.article.pointure %}
                                <div class="text-xs text-gray-400">
                                    {% if panier.article.couleur %}{{ panier.article.couleur }}{% endif %}
                                    {% if panier.article.couleur and panier.article.pointure %} • {% endif %}
                                    {% if panier.article.pointure %}{{ panier.article.pointure }}{% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{ panier.quantite }} pièce{{ panier.quantite|pluralize }}
                        </span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                        {{ panier.article.prix_unitaire|floatformat:2 }} DH
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        {{ panier.sous_total|floatformat:2 }} DH
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        {% if panier.commande.etat_actuel %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                              style="background-color: {{ panier.commande.etat_actuel.enum_etat.couleur }}20; color: {{ panier.commande.etat_actuel.enum_etat.couleur }};">
                            {{ panier.commande.etat_actuel.enum_etat.libelle }}
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                            Nouveau
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                        {{ panier.commande.date_cmd|date:"d/m/Y" }}
                        <div class="text-xs text-gray-400">{{ panier.commande.date_creation|date:"H:i" }}</div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
                        <div class="flex justify-center space-x-2">
                            <a href="{% url 'commande:detail' panier.commande.pk %}" class="text-blue-500 hover:text-blue-700 transition-colors" title="Voir la commande">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'commande:modifier' panier.commande.pk %}" class="text-yellow-500 hover:text-yellow-700 transition-colors" title="Modifier la commande">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="flex justify-center mt-8">
        <nav aria-label="Navigation des paniers">
            <ul class="flex items-center -space-x-px">
            {% if page_obj.has_previous %}
                <li>
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                       class="px-3 py-2 leading-tight bg-white border rounded-l-lg hover:bg-gray-100" 
                       style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                </li>
                <li>
                    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                       class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                       style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                        <i class="fas fa-angle-left"></i>
                    </a>
                </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li>
                        <span class="px-3 py-2 leading-tight text-white border" style="background-color: var(--admin-color); border-color: var(--admin-color);">{{ num }}</span>
                    </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li>
                        <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                           class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                           style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li>
                    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                       class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                       style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                        <i class="fas fa-angle-right"></i>
                    </a>
                </li>
                <li>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                       class="px-3 py-2 leading-tight bg-white border rounded-r-lg hover:bg-gray-100" 
                       style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                </li>
            {% endif %}
            </ul>
        </nav>
    </div>

    <!-- Informations de pagination -->
    <div class="flex justify-center mt-4">
        <div class="text-sm text-gray-600">
            Affichage de {{ page_obj.start_index }} à {{ page_obj.end_index }} sur {{ page_obj.paginator.count }} paniers.
        </div>
    </div>
    {% endif %}
    {% endif %}

    <!-- Vue Cards E-commerce -->
    {% if page_obj %}
    <div id="cardsView" class="hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
            {% for panier in page_obj %}
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 border border-gray-100 overflow-hidden">
                <!-- Header de la card avec info commande -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 border-b border-gray-100">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-gray-800 text-sm">{{ panier.commande.id_yz }}</h3>
                            {% if panier.commande.num_cmd %}
                            <p class="text-xs text-gray-500">({{ panier.commande.num_cmd }})</p>
                            {% endif %}
                        </div>
                        <div class="text-right">
                            {% if panier.commande.etat_actuel %}
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" 
                                  style="background-color: {{ panier.commande.etat_actuel.enum_etat.couleur }}20; color: {{ panier.commande.etat_actuel.enum_etat.couleur }};">
                                {{ panier.commande.etat_actuel.enum_etat.libelle }}
                            </span>
                            {% else %}
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                Nouveau
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Image et info produit -->
                <div class="p-4">
                    <div class="flex items-start space-x-3 mb-3">
                        <div class="flex-shrink-0">
                            {% if panier.article.image %}
                            <img class="w-16 h-16 rounded-lg object-cover shadow-md" src="{{ panier.article.image.url }}" alt="{{ panier.article.nom }}">
                            {% else %}
                            <div class="w-16 h-16 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shadow-md">
                                <i class="fas fa-box text-gray-500 text-xl"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 text-sm leading-tight mb-1">{{ panier.article.nom }}</h4>
                            <p class="text-xs text-gray-500 mb-1">{{ panier.article.reference }}</p>
                            {% if panier.article.couleur or panier.article.pointure %}
                            <div class="flex items-center space-x-2 text-xs text-gray-400">
                                {% if panier.article.couleur %}
                                <span class="bg-gray-100 px-2 py-1 rounded">{{ panier.article.couleur }}</span>
                                {% endif %}
                                {% if panier.article.pointure %}
                                <span class="bg-gray-100 px-2 py-1 rounded">{{ panier.article.pointure }}</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Info client -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-100 to-blue-200 flex items-center justify-center">
                                <i class="fas fa-user text-blue-600 text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 text-sm">{{ panier.commande.client.nom }} {{ panier.commande.client.prenom }}</p>
                                <p class="text-xs text-gray-500">{{ panier.commande.client.numero_tel }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quantité et prix -->
                    <div class="flex justify-between items-center mb-3">
                        <div class="text-center">
                            <p class="text-xs text-gray-500 mb-1">Quantité</p>
                            <span class="inline-flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-800 rounded-full text-sm font-bold">
                                {{ panier.quantite }}
                            </span>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-500 mb-1">Prix Unit.</p>
                            <p class="font-semibold text-gray-800 text-sm">{{ panier.article.prix_unitaire|floatformat:2 }} DH</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-500 mb-1">Total</p>
                            <p class="font-bold text-lg" style="color: var(--admin-color);">{{ panier.sous_total|floatformat:2 }} DH</p>
                        </div>
                    </div>

                    <!-- Date -->
                    <div class="text-center mb-3">
                        <p class="text-xs text-gray-500">{{ panier.commande.date_cmd|date:"d/m/Y" }} à {{ panier.commande.date_creation|date:"H:i" }}</p>
                    </div>

                    <!-- Actions -->
                    <div class="flex justify-center space-x-2">
                        <a href="{% url 'commande:detail' panier.commande.pk %}" 
                           class="flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium py-2 px-3 rounded-lg transition-colors text-center">
                            <i class="fas fa-eye mr-1"></i>Voir
                        </a>
                        <a href="{% url 'commande:modifier' panier.commande.pk %}" 
                           class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-xs font-medium py-2 px-3 rounded-lg transition-colors text-center">
                            <i class="fas fa-edit mr-1"></i>Modifier
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination pour les cards -->
        {% if page_obj.has_other_pages %}
        <div class="flex justify-center mt-8">
            <nav aria-label="Navigation des paniers">
                <ul class="flex items-center -space-x-px">
                {% if page_obj.has_previous %}
                    <li>
                        <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                           class="px-3 py-2 leading-tight bg-white border rounded-l-lg hover:bg-gray-100" 
                           style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                    </li>
                    <li>
                        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                           class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                           style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <li>
                            <span class="px-3 py-2 leading-tight text-white border" style="background-color: var(--admin-color); border-color: var(--admin-color);">{{ num }}</span>
                        </li>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li>
                            <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                               class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                               style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <li>
                        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                           class="px-3 py-2 leading-tight bg-white border hover:bg-gray-100" 
                           style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                            <i class="fas fa-angle-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if client_filter %}&client={{ client_filter }}{% endif %}{% if article_filter %}&article={{ article_filter }}{% endif %}{% if etat_filter %}&etat={{ etat_filter }}{% endif %}" 
                           class="px-3 py-2 leading-tight bg-white border rounded-r-lg hover:bg-gray-100" 
                           style="color: var(--admin-color); border-color: var(--admin-light-accent); hover:text-gray-700;">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    </li>
                {% endif %}
                </ul>
            </nav>
        </div>

        <!-- Informations de pagination -->
        <div class="flex justify-center mt-4">
            <div class="text-sm text-gray-600">
                Affichage de {{ page_obj.start_index }} à {{ page_obj.end_index }} sur {{ page_obj.paginator.count }} paniers.
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}


</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const viewTableBtn = document.getElementById('viewTable');
    const viewCardsBtn = document.getElementById('viewCards');
    const tableView = document.getElementById('tableView');
    const cardsView = document.getElementById('cardsView');
    
    // Vérifier que tous les éléments existent
    if (!viewTableBtn || !viewCardsBtn || !tableView || !cardsView) {
        console.warn('Certains éléments pour le basculement de vue ne sont pas trouvés');
        return;
    }
    
    // Variable pour éviter les clics multiples
    let isChangingView = false;
    
    // Basculer vers la vue tableau
    viewTableBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (isChangingView) return;
        isChangingView = true;
        tableView.classList.remove('hidden');
        cardsView.classList.add('hidden');
        
        // Mise à jour des boutons
        viewTableBtn.classList.add('bg-white', 'shadow-sm');
        viewTableBtn.classList.remove('text-gray-600');
        viewTableBtn.style.color = 'var(--admin-color)';
        
        viewCardsBtn.classList.remove('bg-white', 'shadow-sm');
        viewCardsBtn.classList.add('text-gray-600');
        viewCardsBtn.style.color = '';
        
        // Sauvegarde de la préférence
        localStorage.setItem('paniers_view_preference', 'table');
        
        setTimeout(() => { isChangingView = false; }, 100);
    });
    
    // Basculer vers la vue cards
    viewCardsBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (isChangingView) return;
        isChangingView = true;
        cardsView.classList.remove('hidden');
        tableView.classList.add('hidden');
        
        // Mise à jour des boutons
        viewCardsBtn.classList.add('bg-white', 'shadow-sm');
        viewCardsBtn.classList.remove('text-gray-600');
        viewCardsBtn.style.color = 'var(--admin-color)';
        
        viewTableBtn.classList.remove('bg-white', 'shadow-sm');
        viewTableBtn.classList.add('text-gray-600');
        viewTableBtn.style.color = '';
        
        // Sauvegarde de la préférence
        localStorage.setItem('paniers_view_preference', 'cards');
        
        setTimeout(() => { isChangingView = false; }, 100);
    });
    
    // Fonction pour initialiser l'affichage sans déclencher d'événements
    function initializeView(viewType) {
        if (viewType === 'cards') {
            cardsView.classList.remove('hidden');
            tableView.classList.add('hidden');
            
            viewCardsBtn.classList.add('bg-white', 'shadow-sm');
            viewCardsBtn.classList.remove('text-gray-600');
            viewCardsBtn.style.color = 'var(--admin-color)';
            
            viewTableBtn.classList.remove('bg-white', 'shadow-sm');
            viewTableBtn.classList.add('text-gray-600');
            viewTableBtn.style.color = '';
        } else {
            tableView.classList.remove('hidden');
            cardsView.classList.add('hidden');
            
            viewTableBtn.classList.add('bg-white', 'shadow-sm');
            viewTableBtn.classList.remove('text-gray-600');
            viewTableBtn.style.color = 'var(--admin-color)';
            
            viewCardsBtn.classList.remove('bg-white', 'shadow-sm');
            viewCardsBtn.classList.add('text-gray-600');
            viewCardsBtn.style.color = '';
        }
    }
    
    // Restaurer la préférence au chargement sans déclencher d'événements
    const savedPreference = localStorage.getItem('paniers_view_preference');
    initializeView(savedPreference === 'cards' ? 'cards' : 'table');
});
</script>

<style>
/* Animations personnalisées */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-slideInUp {
    animation: slideInUp 0.5s ease-out forwards;
}

/* Effets de survol pour les cards */
.panier-card:hover {
    transform: translateY(-2px);
    transition: all 0.2s ease-in-out;
}

/* Style pour les badges d'état */
.badge-etat {
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Transition fluide pour le switch de vue */
#tableView, #cardsView {
    transition: opacity 0.3s ease-in-out;
}

/* Effet de loading pour les images */
.product-image {
    transition: transform 0.2s ease-in-out;
}

.product-image:hover {
    transform: scale(1.05);
}

/* Responsive design pour les cards */
@media (max-width: 768px) {
    .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}

@media (min-width: 1025px) and (max-width: 1280px) {
    .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }
}

@media (min-width: 1281px) {
    .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4 {
        grid-template-columns: repeat(4, minmax(0, 1fr));
    }
}
</style>
{% endblock %} 