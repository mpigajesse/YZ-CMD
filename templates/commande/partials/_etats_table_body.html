{% load commande_filters %}
{% for etat in page_obj %}
<tr class="hover:bg-gray-50 transition-colors">
    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900 border-r" style="border-color: var(--admin-light-accent);">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-xs font-bold text-white" style="background-color: {{ etat.couleur }};">
            {{ etat.ordre }}
        </span>
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium border-r" style="color: var(--admin-color); border-color: var(--admin-light-accent);">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" style="background-color: {{ etat.couleur }}20; color: {{ etat.couleur }};">
            {{ etat.libelle }}
        </span>
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 border-r" style="border-color: var(--admin-light-accent);">
        <div class="flex items-center">
            <div class="w-6 h-6 rounded border-2 border-gray-300 mr-2 cursor-pointer" style="background-color: {{ etat.couleur }};" onclick="openColorPicker({{ etat.id }}, '{{ etat.couleur }}')"></div>
            <code class="text-xs bg-gray-100 px-2 py-1 rounded">{{ etat.couleur }}</code>
        </div>
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-sm text-center border-r" style="border-color: var(--admin-light-accent);">
        {% with stats_etats|lookup:etat.id as stats %}
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-xs font-bold
            {% if stats.commandes_actuelles > 0 %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-500{% endif %}">
            {{ stats.commandes_actuelles }}
        </span>
        {% endwith %}
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-sm text-center border-r" style="border-color: var(--admin-light-accent);">
        {% with stats_etats|lookup:etat.id as stats %}
        <span class="text-gray-600 font-medium">{{ stats.total_historique }}</span>
        {% endwith %}
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 border-r" style="border-color: var(--admin-light-accent);">
        {% if 'payé' in etat.libelle|lower %}
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                <i class="fas fa-credit-card mr-1"></i> Paiement
            </span>
        {% elif 'livr' in etat.libelle|lower or 'préparation' in etat.libelle|lower or 'expédié' in etat.libelle|lower %}
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                <i class="fas fa-truck mr-1"></i> Livraison
            </span>
        {% else %}
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                <i class="fas fa-clipboard-list mr-1"></i> Commande
            </span>
        {% endif %}
    </td>
    <td class="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
        <div class="flex justify-center space-x-2">
            <button onclick="openEditStateModal({{ etat.id }}, '{{ etat.libelle|escapejs }}', '{{ etat.couleur }}', {{ etat.ordre }})" class="text-blue-500 hover:text-blue-700 transition-colors" title="Modifier">
                <i class="fas fa-edit"></i>
            </button>
            <button onclick="moveStateUp({{ etat.id }})" class="text-green-500 hover:text-green-700 transition-colors" title="Monter">
                <i class="fas fa-arrow-up"></i>
            </button>
            <button onclick="moveStateDown({{ etat.id }})" class="text-orange-500 hover:text-orange-700 transition-colors" title="Descendre">
                <i class="fas fa-arrow-down"></i>
            </button>
            <button onclick="confirmDeleteState({{ etat.id }}, '{{ etat.libelle|escapejs }}')" class="text-red-500 hover:text-red-700 transition-colors" title="Supprimer">
                <i class="fas fa-trash-can"></i>
            </button>
        </div>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
        <i class="fas fa-exclamation-circle text-3xl mb-3" style="color: var(--admin-accent-color);"></i>
        <p>Aucun état défini.</p>
        <button onclick="openAddStateModal()" class="mt-3 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm">
            <i class="fas fa-plus mr-2"></i>Créer le premier état
        </button>
    </td>
</tr>
{% endfor %}
